import{r as o,c as t,g as i,h as e,a as r}from"./p-d7d70983.js";let s=0;const l=class{constructor(i){o(this,i),this.optionChange=t(this,"optionChange",7),this.id=(s+=1,`scandash-${s}-dropdown`),this.options=void 0,this.placeholder=void 0,this.itemSize=48,this.fontSize=16,this.sanitizedOptions=null,this.selectedOption=null,this.isExpanded=!1}handleOptionChanged(){this.isExpanded=!1,this.sanitizeOptions(),this.getInitialSelectedOption()}handleIsExpandedChanged(){var o;if(!this.ref)return;this.isExpanded?(addEventListener("click",this.handleClickOutside.bind(this)),this.focusMostAppropriateOption(),this.determineListHeight()):(removeEventListener("click",this.handleClickOutside.bind(this)),null===(o=this.ref.shadowRoot.querySelector('[role="combobox"]'))||void 0===o||o.focus())}handleSelectedOptionChanged(){this.optionChange.emit(this.selectedOption)}async reset(){this.getInitialSelectedOption()}sanitizeOptions(){const o=o=>{if(!Array.isArray(o))throw new Error("TypeError: Options attribute must be of type array.");if(0===o.length)throw new Error("Options attribute must contain at least one option.");const t=o.filter((o=>"object"==typeof o&&!(!o.label||!o.value)&&"string"==typeof o.value)),i=new Map;t.forEach((o=>{i.has(o.value)||i.set(o.value,o)})),this.sanitizedOptions=[...i.values()]};if("string"!=typeof this.options)o(this.options);else{let t=null;try{t=JSON.parse(this.options)}catch(o){console.warn("Invalid JSON string")}o(t)}}getInitialSelectedOption(){var o,t;const i=null===(o=this.sanitizedOptions)||void 0===o?void 0:o.find((o=>o.selected&&!o.disabled)),e=1===this.sanitizedOptions.length?null===(t=this.sanitizedOptions)||void 0===t?void 0:t[0]:null;this.selectedOption=i||e}focusMostAppropriateOption(){var o;const t=this.ref.shadowRoot.querySelector('[role="option"][aria-selected="true"]'),i=this.ref.shadowRoot.querySelector('[role="option"]:not([aria-disabled="true"])');null===(o=t||i)||void 0===o||o.focus()}determineListHeight(){if(!this.ref)return;const o=this.ref.shadowRoot,t=o.querySelector('[role="combobox"]'),i=o.querySelector('[role="listbox"]');if(!t||!i)return;const e=t.getBoundingClientRect(),r=(visualViewport.height||innerHeight)-e.bottom-16;i.style.maxHeight=r<200?"":`${r}px`}handleOptionClicked(o){this.selectedOption=o,this.isExpanded=!1}handleClickOutside(o){this.isExpanded&&(o.target.closest("scandash-dropdown")||(this.isExpanded=!1))}handleKeyUp(o){var t,i,e,r,s,l,n;if(!this.isExpanded||!this.ref)return;const a=this.ref.shadowRoot.querySelectorAll('[role="option"]:not([aria-disabled="true"])'),d=o.target,c=Array.from(a).findIndex((o=>o===d)),h=null===(t=this.sanitizedOptions)||void 0===t?void 0:t.filter((o=>!o.disabled));switch(o.key){case"Tab":this.isExpanded=!1,this.selectedOption=null==h?void 0:h[c];case"ArrowDown":return void(null===(i=a[c+1])||void 0===i||i.focus());case"ArrowUp":return void(null===(e=a[c-1])||void 0===e||e.focus());case"Escape":return void(this.isExpanded=!1);case"PageUp":const o=a[0];return void(null===(r=a[c-10]||o)||void 0===r||r.focus());case"PageDown":const t=a[a.length-1];return void(null===(s=a[c+10]||t)||void 0===s||s.focus());case"Home":return void(null===(l=a[0])||void 0===l||l.focus());case"End":return void(null===(n=a[a.length-1])||void 0===n||n.focus())}}connectedCallback(){this.sanitizeOptions(),this.getInitialSelectedOption()}disconnectedCallback(){removeEventListener("click",this.handleClickOutside.bind(this))}render(){var o,t,r,s;const l=i("assets/chevron.svg");return 0===(null===(o=this.sanitizedOptions)||void 0===o?void 0:o.length)?null:e("div",null,e("button",{role:"combobox","aria-controls":`${this.id}-listbox`,"aria-expanded":this.isExpanded.toString(),"aria-haspopup":"listbox","aria-labelledby":`${this.id}-label`,class:this.selectedOption?void 0:"empty",onClick:()=>this.isExpanded=!this.isExpanded,style:{height:`${this.itemSize}px`,fontSize:`${this.fontSize}px`}},(null===(t=this.selectedOption)||void 0===t?void 0:t.label)?e("strong",null,null===(r=this.selectedOption)||void 0===r?void 0:r.label):e("span",null,this.placeholder||"Select an option..."),e("img",{src:l,alt:"","aria-hidden":"true",class:this.isExpanded?"rotate-180":void 0,style:{height:`${this.itemSize}px`,width:`${this.itemSize}px`}})),e("div",{id:`${this.id}-listbox`,class:this.isExpanded?void 0:"visually-hidden no-events",role:"listbox","aria-labelledby":`${this.id}-label`},null===(s=this.sanitizedOptions)||void 0===s?void 0:s.map(((o,t)=>{var i,r,s;return e("button",{key:t,class:o.disabled?"no-events":void 0,role:"option","aria-disabled":null===(i=o.disabled)||void 0===i?void 0:i.toString(),"aria-posinset":t+1,"aria-selected":((null===(r=this.selectedOption)||void 0===r?void 0:r.value)===o.value).toString(),"aria-setsize":this.sanitizedOptions.length,onClick:()=>!(null==o?void 0:o.disabled)&&this.handleOptionClicked(o),onKeyDown:o=>["ArrowDown","ArrowUp","Escape","Home","End","PageDown","PageUp","Tab"].includes(o.key)&&o.preventDefault(),onKeyUp:o=>this.handleKeyUp(o),tabIndex:this.isExpanded&&!o.disabled?0:-1,style:{height:`${this.itemSize}px`,fontSize:`${this.fontSize}px`}},(null===(s=this.selectedOption)||void 0===s?void 0:s.value)===o.value?e("strong",null,o.label):e("span",null,o.label))}))))}static get assetsDirs(){return["assets"]}get ref(){return r(this)}static get watchers(){return{options:["handleOptionChanged"],isExpanded:["handleIsExpandedChanged"],selectedOption:["handleSelectedOptionChanged"]}}};l.style=".visually-hidden{position:absolute;overflow:hidden;height:1px;width:1px;padding:0;border:0;clip:rect(1px, 1px, 1px, 1px);clip-path:inset(0px 0px 99.9% 99.9%);-webkit-clip-path:inset(0px 0px 99.9% 99.9%)}.no-events{pointer-events:none}:host{--combo-bg-color:rgb(255, 255, 255);--combo-border-color:rgb(56, 65, 79);--combo-border-color-empty:rgb(224, 226, 235);--combo-border-color-empty-hover:rgb(134, 143, 162);--combo-placehoder-color:rgb(85, 101, 122);--list-hover-color:rgb(237, 239, 243);--list-focus-color:rgb(240, 240, 240);--list-active-color:rgb(219, 223, 230);--list-border-color:rgb(219, 223, 230)}*{box-sizing:border-box}button{width:100%;text-align:start;background:none;border:none;appearance:none}span,strong{display:-webkit-box;overflow:hidden;width:100%;padding:0 1em;font-weight:normal;-webkit-box-orient:vertical;-webkit-line-clamp:2}div{display:flex;flex-direction:column;position:relative}[role='combobox']{display:flex;flex-direction:row;align-items:center;justify-content:space-between;position:relative;background-color:var(--combo-bg-color);border-bottom:1px solid var(--combo-border-color);border-top-left-radius:5px;border-top-right-radius:5px}[role='combobox'].empty{border-bottom:1px solid var(--combo-border-color-empty)}[role='combobox'].empty:hover{border-bottom:1px solid var(--combo-border-color-empty-hover)}[role='combobox']>span{color:var(--combo-placehoder-color)}[role='combobox']>img{transform:scale(0.25)}[role='combobox']>img.rotate-180{transform:scale(-1) scale(0.25)}[role='listbox']{display:block;position:absolute;overflow-y:auto;width:100%;top:calc(100% - 1px);left:0;background-color:white;border:1px solid var(--list-border-color)}[role='option']{cursor:pointer;outline:none}[role='option']:not([aria-selected='true']):hover{background-color:var(--list-hover-color)}[role='option']:not([aria-selected='true']):focus{background-color:var(--list-focus-color)}[aria-disabled='true']{opacity:0.5}[aria-selected='true']{background-color:var(--list-active-color)}";export{l as scandash_dropdown}